#!/usr/bin/env ruby

libdir = File.expand_path('../../lib', __FILE__).sub(/^#{Dir.pwd}\//, '')
begin 
  require 'tic_tac_toe'
rescue LoadError
  case $!.to_s
  when /tic_tac_toe/
  if !$:.include?(libdir)
      warn "warn: #$!. trying again with #{libdir} on load path"
      $:.unshift(libdir)
      retry
    end
  end
  raise
end

def setup
  game = TicTacToe::Game.new
  terminal = TicTacToe::TerminalGame.new(game.board)
  first = (terminal.computer_goes_first? ? 'o' : 'x')

  [game, terminal, first]
end

game, terminal, first = setup

loop do

  terminal.update_board

  params = {
    :board => game.grid,
    :first => first,
    "#{first}".to_sym => terminal.get_move_from_user
  }

  game = TicTacToe::Game.new(params).play


  if game.solved? || game.cats?
    terminal.update_board
    break unless terminal.play_again?
    game, terminal, first = setup
  end

end

